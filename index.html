<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"
  />
  <title>حاسبة البلوت</title>
  <style>
    :root {
      color-scheme: dark;
      --bg: #05070b;
      --card: #141820;
      --card-highlight-lana: #15803d;
      --card-highlight-lahom: #b91c1c;
      --accent: #32e07b;
      --text-main: #ffffff;
      --text-muted: #a0aec0;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    html,
    body {
      height: 100%;
      margin: 0;
    }

    body {
      background: radial-gradient(circle at top, #111827, #020617 55%);
      color: var(--text-main);
      display: flex;
      flex-direction: column;
    }

    .app {
      min-height: 100vh;
      max-width: 600px;
      margin: 0 auto;
      padding: 12px;
      display: flex;
      flex-direction: column;
      padding-bottom: env(safe-area-inset-bottom, 0px);
    }

    header {
      padding: 8px 0 4px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .boards {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 10px;
      flex: 1;
    }

    .card-row {
      display: flex;
      gap: 6px;
      flex: 1;
    }

    .card {
      flex: 1.1;
      background: linear-gradient(145deg, var(--card), #020617);
      border-radius: 16px;
      padding: 6px 20px;
      box-shadow: 0 18px 35px rgba(0, 0, 0, 0.6);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .card-lana.highlight {
      background: linear-gradient(145deg, var(--card-highlight-lana), #064e3b);
    }

    .card-lahom.highlight {
      background: linear-gradient(145deg, var(--card-highlight-lahom), #7f1d1d);
    }

    .wins-badge {
      font-size: 0.9rem;
      color: #e5e7eb;
      margin-bottom: 4px;
    }

    .card-title {
      font-size: 3.5rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      margin-bottom: 8px;
      text-transform: uppercase;
    }

    .score {
      font-size: 5rem;
      font-weight: 800;
      line-height: 1.1;
      margin: 2px 0;
    }

    .remaining {
      margin-top: 4px;
      font-size: 3.2rem;
      font-weight: 700;
      color: var(--accent);
      min-height: 3.4rem; /* حجز مساحة ثابتة للمتبقي */
    }

    .remaining.zero {
      color: #facc15;
    }

    .label-remaining {
      font-size: 0.9rem;
      color: var(--text-muted);
      letter-spacing: 0.12em;
      text-transform: uppercase;
      margin-top: 2px;
      min-height: 1.2rem; /* حجز مساحة لعنوان المتبقي */
    }

    .rotate-180 {
      transform: rotate(180deg);
    }

    .middle-input {
      margin-top: 8px;
      margin-bottom: 8px;
      padding: 8px 10px;
      background: rgba(15, 23, 42, 0.9);
      border-radius: 16px;
      backdrop-filter: blur(18px);
      box-shadow: 0 -8px 25px rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .middle-input .inputs-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .inputs input[type="number"] {
      width: 90px;
      padding: 6px 8px;
      border-radius: 10px;
      border: 1px solid #1f2937;
      background: #020617;
      color: var(--text-main);
      font-size: 1rem;
      text-align: center;
      outline: none;
    }

    .inputs input[type="number"]::-webkit-outer-spin-button,
    .inputs input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .inputs input[type="number"] {
      -moz-appearance: textfield;
    }

    .input-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 3px;
      display: block;
      text-align: center;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: transform 0.12s ease, box-shadow 0.12s ease,
        background 0.15s ease;
      white-space: nowrap;
    }

    .btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #052e16;
      box-shadow: 0 14px 25px rgba(22, 163, 74, 0.35);
    }

    .btn-secondary {
      background: transparent;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: var(--text-main);
    }

    .btn-undo-icon {
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      border: 1px solid rgba(148, 163, 184, 0.5);
      padding: 6px 10px;
      border-radius: 999px;
      min-width: 40px;
    }

    .btn svg {
      width: 16px;
      height: 16px;
    }

    .bottom-bar {
      margin-top: 4px;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      font-size: 0.78rem;
      color: var(--text-muted);
      gap: 8px;
    }

    .toast {
      position: fixed;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-main);
      padding: 8px 16px;
      border-radius: 999px;
      font-size: 0.85rem;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.7);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
      z-index: 50;
    }

    .toast.show {
      opacity: 1;
      pointer-events: auto;
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.8);
      display: none;
      align-items: flex-end;
      justify-content: center;
      z-index: 40;
    }

    .modal {
      width: 100%;
      max-width: 600px;
      max-height: 70vh;
      background: #020617;
      border-radius: 18px 18px 0 0;
      padding: 12px;
      overflow-y: auto;
      box-shadow: 0 -12px 30px rgba(0, 0, 0, 0.7);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .modal-header h2 {
      font-size: 1rem;
    }

    .modal-close {
      background: transparent;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 1.1rem;
    }

    .history-item {
      padding: 8px 4px;
      border-bottom: 1px solid rgba(30, 64, 175, 0.3);
      font-size: 0.9rem;
    }

    .history-item:last-child {
      border-bottom: none;
    }

    .history-line {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2px;
    }

    .history-label {
      color: var(--text-muted);
      font-size: 0.8rem;
    }

    .winner-overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(
        circle at top,
        rgba(34, 197, 94, 0.16),
        rgba(15, 23, 42, 0.96)
      );
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 60;
    }

    .winner-card {
      max-width: 90%;
      background: #020617;
      border-radius: 24px;
      padding: 18px 16px 24px;
      text-align: center;
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(74, 222, 128, 0.4);
      position: relative;
    }

    .winner-title {
      font-size: 1.6rem;
      font-weight: 800;
      margin-bottom: 8px;
    }

    .winner-name {
      font-size: 1.3rem;
      font-weight: 700;
      margin: 4px 0 8px;
      color: #4ade80;
    }

    .winner-scores {
      font-size: 1rem;
      line-height: 1.8;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .winner-time {
      font-size: 0.95rem;
      color: #e5e7eb;
      margin-bottom: 10px;
    }

    .winner-close {
      position: absolute;
      top: 10px;
      inset-inline-end: 14px;
      background: transparent;
      border: none;
      color: var(--text-muted);
      font-size: 1.4rem;
      cursor: pointer;
    }

    @media (max-width: 480px) {
      .score {
        font-size: 3.4rem;
      }
      .remaining {
        font-size: 2.4rem;
      }
      .card-title {
        font-size: 2.4rem;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- هيدر بدون اسم، أزرار في المنتصف، زر إعادة التراجع على الطرف -->
    <header>
      <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; width:100%;">
        <div style="flex:1; display:flex; align-items:center; justify-content:center; gap:8px;">
          <button class="btn btn-history" id="btn-history">عرض السجل</button>
          <button class="btn btn-secondary" id="btn-new-game">صكة جديدة</button>
        </div>

        <button
          id="btn-redo"
          title="إعادة آخر تراجع"
          style="
            background: transparent;
            border: none;
            color: #9ca3af;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink:0;
          "
        >
          <svg viewBox="0 0 24 24" fill="none" style="width: 20px; height: 20px">
            <path
              d="M15 5l5 5-5 5"
              stroke="#9ca3af"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M4 19a8 8 0 018-8h8"
              stroke="#9ca3af"
              stroke-width="2"
              stroke-linecap="round"
            />
          </svg>
        </button>
      </div>
    </header>

    <main class="boards">
      <!-- لوحات أعلى -->
      <section class="card-row" id="row-top">
        <section class="card card-lana" id="card-lana-top">
          <div class="card-inner">
            <div class="wins-badge" id="wins-lana-top">0</div>
            <div class="card-title">لنا</div>
            <div class="score" id="score-lana-top">0</div>
            <div class="remaining" id="remaining-lana-top" style="visibility:hidden;">0</div>
            <div class="label-remaining" id="label-remaining-lana-top" style="visibility:hidden;">المتبقي</div>
          </div>
        </section>

        <section class="card card-lahom" id="card-lahom-top">
          <div class="card-inner">
            <div class="wins-badge" id="wins-lahom-top">0</div>
            <div class="card-title">لهم</div>
            <div class="score" id="score-lahom-top">0</div>
            <div class="remaining" id="remaining-lahom-top" style="visibility:hidden;">0</div>
            <div class="label-remaining" id="label-remaining-lahom-top" style="visibility:hidden;">المتبقي</div>
          </div>
        </section>
      </section>

      <!-- إدخال في المنتصف -->
      <section class="middle-input">
        <div class="inputs-row">
          <div class="inputs">
            <label for="input-lana" class="input-label">لنا</label>
            <input type="number" id="input-lana" inputmode="numeric" />
          </div>

          <button class="btn btn-undo-icon" id="btn-undo" title="تراجع">
            <svg viewBox="0 0 24 24" fill="none">
              <path
                d="M9 5L4 10l5 5"
                stroke="#e5e7eb"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M20 19a8 8 0 00-8-8H4"
                stroke="#e5e7eb"
                stroke-width="2"
                stroke-linecap="round"
              />
            </svg>
          </button>

          <div class="inputs">
            <label for="input-lahom" class="input-label">لهم</label>
            <input type="number" id="input-lahom" inputmode="numeric" />
          </div>
        </div>

        <button class="btn btn-primary" id="btn-add">
          <span>إضافة الجولة</span>
          <svg viewBox="0 0 24 24" fill="none">
            <path
              d="M12 5v14m-7-7h14"
              stroke="#052e16"
              stroke-width="2"
              stroke-linecap="round"
            />
          </svg>
        </button>
      </section>

      <!-- لوحات أسفل معكوسة -->
      <section class="card-row rotate-180" id="row-bottom">
        <section class="card card-lana" id="card-lana-bottom">
          <div class="card-inner">
            <div class="wins-badge" id="wins-lana-bottom">0</div>
            <div class="card-title">لنا</div>
            <div class="score" id="score-lana-bottom">0</div>
            <div class="remaining" id="remaining-lana-bottom" style="visibility:hidden;">0</div>
            <div class="label-remaining" id="label-remaining-lana-bottom" style="visibility:hidden;">المتبقي</div>
          </div>
        </section>

        <section class="card card-lahom" id="card-lahom-bottom">
          <div class="card-inner">
            <div class="wins-badge" id="wins-lahom-bottom">0</div>
            <div class="card-title">لهم</div>
            <div class="score" id="score-lahom-bottom">0</div>
            <div class="remaining" id="remaining-lahom-bottom" style="visibility:hidden;">0</div>
            <div class="label-remaining" id="label-remaining-lahom-bottom" style="visibility:hidden;">المتبقي</div>
          </div>
        </section>
      </section>
    </main>

    <div class="bottom-bar">
      <span>الحالة محفوظة في الجهاز</span>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <div class="modal-backdrop" id="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <h2>السجل</h2>
        <button class="modal-close" id="modal-close">&times;</button>
      </div>
      <div id="history-list"></div>
    </div>
  </div>

  <div class="winner-overlay" id="winner-overlay">
    <div class="winner-card">
      <button class="winner-close" id="winner-close">&times;</button>
      <div class="winner-title" id="winner-title">انتهت الصكة</div>
      <div class="winner-name" id="winner-name">الفائز: لنا</div>
      <div class="winner-scores" id="winner-scores">
        لنا: 152 نقطة<br />
        لهم: 120 نقطة
      </div>
      <div class="winner-time" id="winner-time">مدة الصكة: 00:00</div>
      <button class="btn btn-primary" id="btn-new-game-winner">صكة جديدة</button>
    </div>
  </div>

  <script>
    const TARGET = 152;
    const THRESHOLD = 100;

    let lanaScore = 0;
    let lahomScore = 0;
    let history = [];
    let winnerShown = false;
    let lastUndone = null;

    let lanaWins = 0;
    let lahomWins = 0;

    let startTimestamp = null;
    let timerInterval = null;

    const inputLana = document.getElementById("input-lana");
    const inputLahom = document.getElementById("input-lahom");
    const btnAdd = document.getElementById("btn-add");
    const btnUndo = document.getElementById("btn-undo");
    const btnRedo = document.getElementById("btn-redo");
    const btnHistory = document.getElementById("btn-history");
    const btnNewGame = document.getElementById("btn-new-game");
    const btnNewGameWinner = document.getElementById("btn-new-game-winner");

    const toast = document.getElementById("toast");
    const modalBackdrop = document.getElementById("modal-backdrop");
    const modalClose = document.getElementById("modal-close");
    const historyList = document.getElementById("history-list");

    const winnerOverlay = document.getElementById("winner-overlay");
    const winnerClose = document.getElementById("winner-close");
    const winnerTitle = document.getElementById("winner-title");
    const winnerNameEl = document.getElementById("winner-name");
    const winnerScoresEl = document.getElementById("winner-scores");
    const winnerTimeEl = document.getElementById("winner-time");

    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(() => {
        toast.classList.remove("show");
      }, 1500);
    }

    function saveState() {
      const data = {
        lanaScore,
        lahomScore,
        history,
        lastUndone,
        lanaWins,
        lahomWins,
        startTimestamp,
      };
      localStorage.setItem("balootScoreState", JSON.stringify(data));
    }

    function loadState() {
      const raw = localStorage.getItem("balootScoreState");
      if (!raw) return;
      try {
        const data = JSON.parse(raw);
        lanaScore = data.lanaScore ?? 0;
        lahomScore = data.lahomScore ?? 0;
        history = Array.isArray(data.history) ? data.history : [];
        lastUndone = data.lastUndone ?? null;
        lanaWins = data.lanaWins ?? 0;
        lahomWins = data.lahomWins ?? 0;
        startTimestamp = data.startTimestamp ?? null;
        if (startTimestamp !== null) {
          startClock();
        }
      } catch (e) {
        console.error("Failed to load state", e);
      }
    }

    function remainingPure(score) {
      if (score < THRESHOLD) return null;
      const remaining = TARGET - score;
      if (remaining <= 0) return 0;
      return remaining;
    }

    function updateWinsDisplay() {
      document.getElementById("wins-lana-top").textContent = lanaWins;
      document.getElementById("wins-lana-bottom").textContent = lanaWins;
      document.getElementById("wins-lahom-top").textContent = lahomWins;
      document.getElementById("wins-lahom-bottom").textContent = lahomWins;
    }

    function updateBoard() {
      document.getElementById("score-lana-top").textContent = lanaScore;
      document.getElementById("score-lahom-top").textContent = lahomScore;
      document.getElementById("score-lana-bottom").textContent = lanaScore;
      document.getElementById("score-lahom-bottom").textContent = lahomScore;

      updateWinsDisplay();

      const lanaLeading = lanaScore > lahomScore;
      const lahomLeading = lahomScore > lanaScore;

      document
        .getElementById("card-lana-top")
        .classList.toggle("highlight", lanaLeading);
      document
        .getElementById("card-lahom-top")
        .classList.toggle("highlight", lahomLeading);
      document
        .getElementById("card-lana-bottom")
        .classList.toggle("highlight", lanaLeading);
      document
        .getElementById("card-lahom-bottom")
        .classList.toggle("highlight", lahomLeading);

      const remLana = remainingPure(lanaScore);
      ["top", "bottom"].forEach((pos) => {
        const remEl = document.getElementById(`remaining-lana-${pos}`);
        const labelEl = document.getElementById(`label-remaining-lana-${pos}`);
        if (remLana === null) {
          remEl.style.visibility = "hidden";
          labelEl.style.visibility = "hidden";
        } else {
          remEl.style.visibility = "visible";
          labelEl.style.visibility = "visible";
          remEl.textContent = remLana;
          remEl.classList.toggle("zero", remLana === 0);
        }
      });

      const remLahom = remainingPure(lahomScore);
      ["top", "bottom"].forEach((pos) => {
        const remEl = document.getElementById(`remaining-lahom-${pos}`);
        const labelEl = document.getElementById(`label-remaining-lahom-${pos}`);
        if (remLahom === null) {
          remEl.style.visibility = "hidden";
          labelEl.style.visibility = "hidden";
        } else {
          remEl.style.visibility = "visible";
          labelEl.style.visibility = "visible";
          remEl.textContent = remLahom;
          remEl.classList.toggle("zero", remLahom === 0);
        }
      });

      checkWinner();
    }

    function addRound(lana, lahom) {
      if (lana === 0 && lahom === 0) return;
      startClockIfNeeded();
      lanaScore += lana;
      lahomScore += lahom;
      history.push({
        lana,
        lahom,
        lanaAfter: lanaScore,
        lahomAfter: lahomScore,
      });
      lastUndone = null;
      updateBoard();
      saveState();
    }

    function undoLast() {
      if (history.length === 0) {
        showToast("لا يوجد جولات للتراجع");
        return;
      }
      const last = history.pop();
      lanaScore -= last.lana;
      lahomScore -= last.lahom;
      if (lanaScore < 0) lanaScore = 0;
      if (lahomScore < 0) lahomScore = 0;
      lastUndone = last;
      winnerShown = false;
      updateBoard();
      showToast("تم التراجع عن آخر جولة");
      saveState();
    }

    function redoLast() {
      if (!lastUndone) {
        showToast("لا يوجد جولة لإعادتها");
        return;
      }
      lanaScore += lastUndone.lana;
      lahomScore += lastUndone.lahom;
      history.push({
        lana: lastUndone.lana,
        lahom: lastUndone.lahom,
        lanaAfter: lanaScore,
        lahomAfter: lahomScore,
      });
      lastUndone = null;
      updateBoard();
      showToast("تم إعادة الجولة");
      saveState();
    }

    function renderHistory() {
      if (history.length === 0) {
        historyList.innerHTML =
          '<p style="font-size:0.85rem;color:var(--text-muted);text-align:center;padding:8px;">لا يوجد جولات مسجلة حتى الآن</p>';
        return;
      }
      let html = "";
      history.forEach((round, index) => {
        html += `
          <div class="history-item">
            <div class="history-line">
              <span>جولة ${index + 1}</span>
              <span class="history-label">المجموع بعد الجولة</span>
            </div>
            <div class="history-line">
              <span>لنا: ${round.lana} | لهم: ${round.lahom}</span>
              <span>لنا ${round.lanaAfter} · لهم ${round.lahomAfter}</span>
            </div>
          </div>
        `;
      });
      historyList.innerHTML = html;
    }

    function getElapsedSeconds() {
      if (startTimestamp === null) return 0;
      const now = Date.now();
      return Math.floor((now - startTimestamp) / 1000);
    }

    function formatSeconds(sec) {
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      const mm = m.toString().padStart(2, "0");
      const ss = s.toString().padStart(2, "0");
      return `${mm}:${ss}`;
    }

    function startClock() {
      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(() => {}, 1000);
    }

    function startClockIfNeeded() {
      if (startTimestamp !== null) return;
      startTimestamp = Date.now();
      startClock();
      saveState();
    }

    function checkWinner() {
      if (winnerShown) return;

      if (lanaScore >= TARGET || lahomScore >= TARGET) {
        winnerShown = true;

        let nameText = "";
        if (lanaScore > lahomScore) {
          nameText = "الفائز: الفريق (لنا)";
          lanaWins += 1;
        } else if (lahomScore > lanaScore) {
          nameText = "الفائز: الفريق (لهم)";
          lahomWins += 1;
        } else {
          nameText = "تعادل بين الفريقين";
        }

        winnerTitle.textContent = "انتهت الصكة";
        winnerNameEl.textContent = nameText;
        winnerScoresEl.innerHTML = `
          لنا: ${lanaScore} نقطة<br>
          لهم: ${lahomScore} نقطة
        `;

        const elapsed = getElapsedSeconds();
        winnerTimeEl.textContent = `مدة الصكة: ${formatSeconds(elapsed)}`;

        if (timerInterval) {
          clearInterval(timerInterval);
          timerInterval = null;
        }

        updateWinsDisplay();
        saveState();

        winnerOverlay.style.display = "flex";
      }
    }

    function resetRoundOnly() {
      lanaScore = 0;
      lahomScore = 0;
      history = [];
      lastUndone = null;
      winnerShown = false;
      winnerOverlay.style.display = "none";

      startTimestamp = Date.now();
      startClock();
      updateBoard();
      saveState();
      showToast("تم بدء صكة جديدة (نفس عدد مرات الفوز)");
    }

    function resetAll() {
      lanaScore = 0;
      lahomScore = 0;
      history = [];
      lastUndone = null;
      winnerShown = false;
      lanaWins = 0;
      lahomWins = 0;
      winnerOverlay.style.display = "none";

      if (timerInterval) clearInterval(timerInterval);
      timerInterval = null;
      startTimestamp = null;

      updateBoard();
      saveState();
      showToast("تم تصفير كل شيء وبداية جديدة");
    }

    function sanitizeTwoDigits(input) {
      if (input.value.length > 2) {
        input.value = input.value.slice(0, 2);
      }
    }

    function tryAutoAdd() {
      const lanaStr = inputLana.value.trim();
      const lahomStr = inputLahom.value.trim();

      const hasLana = lanaStr !== "";
      const hasLahom = lahomStr !== "";

      if (!hasLana || !hasLahom) return;

      const lanaVal = parseInt(lanaStr, 10);
      const lahomVal = parseInt(lahomStr, 10);

      if (Number.isNaN(lanaVal) || Number.isNaN(lahomVal)) return;

      inputLana.value = "";
      inputLahom.value = "";

      addRound(lanaVal, lahomVal);

      inputLana.blur();
      inputLahom.blur();
    }

    inputLana.addEventListener("input", () => {
      sanitizeTwoDigits(inputLana);

      if (inputLana.value.length < 2) return;

      const otherHasValue = inputLahom.value.trim() !== "";

      if (otherHasValue) {
        tryAutoAdd();
      } else {
        inputLahom.focus();
      }
    });

    inputLahom.addEventListener("input", () => {
      sanitizeTwoDigits(inputLahom);

      if (inputLahom.value.length < 2) return;

      const otherHasValue = inputLana.value.trim() !== "";

      if (otherHasValue) {
        tryAutoAdd();
      } else {
        inputLana.focus();
      }
    });

    btnAdd.addEventListener("click", () => {
      const lanaVal = parseInt(inputLana.value || "0", 10);
      const lahomVal = parseInt(inputLahom.value || "0", 10);
      inputLana.value = "";
      inputLahom.value = "";
      addRound(lanaVal || 0, lahomVal || 0);
      inputLana.blur();
      inputLahom.blur();
    });

    btnUndo.addEventListener("click", () => {
      undoLast();
    });

    btnRedo.addEventListener("click", () => {
      redoLast();
    });

    btnHistory.addEventListener("click", () => {
      renderHistory();
      modalBackdrop.style.display = "flex";
    });

    modalClose.addEventListener("click", () => {
      modalBackdrop.style.display = "none";
    });

    modalBackdrop.addEventListener("click", (e) => {
      if (e.target === modalBackdrop) {
        modalBackdrop.style.display = "none";
      }
    });

    winnerClose.addEventListener("click", () => {
      winnerOverlay.style.display = "none";
    });

    winnerOverlay.addEventListener("click", (e) => {
      if (e.target === winnerOverlay) {
        winnerOverlay.style.display = "none";
      }
    });

    btnNewGame.addEventListener("click", () => {
      resetAll();
    });

    btnNewGameWinner.addEventListener("click", () => {
      resetRoundOnly();
    });

    loadState();
    updateBoard();
  </script>
</body>
</html>
